---
title: 'New file'
description: 'Description of your new file.'
---

(function () {
  console.log(window.self !== window.top);
  if (window.self !== window.top) {
    return; // Exit if this is running in an iframe
  }

  if (typeof window !== "undefined") {
    const params = new URLSearchParams(window.location.search);
    if (params.get("embed") === "true") {
      return; // Skip adding button
    }

    let scriptEl = document.currentScript;
    if (!scriptEl) {
      console.warn("Floating button script: currentScript is null");
      return;
    }

    // Read attributes
    let buttonLabel = scriptEl.getAttribute("data-label") || "Chat";
    let passKey = scriptEl.getAttribute("data-passkey") || "";
    let position = scriptEl.getAttribute("data-position") || "bottom-right";

    fetch(`http://auth.torq.local:3000/api/v1/domain?tenantId=${passKey}`)
      .then((res) => res.json())
      .then((data) => {
        if (data.body) {
          let iframeUrl = data.body.dataUrl;
          let brandInfo = data.body.brand;
          let brandColor = (brandInfo && brandInfo.brandColor) || "#007bff";
          let brandIcon = (brandInfo && brandInfo.icon) || "";
          let brandName = (brandInfo && brandInfo.name) || "Torqbit";

          // Create floating button
          let btn = document.createElement("button");
          btn.innerText = buttonLabel;
          btn.style.position = "fixed";
          btn.style.zIndex = "9999";
          btn.style.backgroundColor = "#007bff";
          btn.style.color = "#fff";
          btn.style.border = "none";
          btn.style.borderRadius = "50px";
          btn.style.padding = "12px 20px";
          btn.style.fontSize = "16px";
          btn.style.cursor = "pointer";
          btn.style.boxShadow = "0 4px 6px rgba(0,0,0,0.2)";

          // Panel container
          let panel = document.createElement("div");
          panel.style.position = "fixed";
          panel.style.width = "400px";
          panel.style.height = "600px";
          panel.style.background = "#fff";
          panel.style.border = "1px solid #ccc";
          panel.style.borderRadius = "12px";
          panel.style.borderRadius = "12px";
          panel.style.boxShadow = "0 4px 12px rgba(0,0,0,0.3)";
          panel.style.display = "none";
          panel.style.zIndex = "10000";
          panel.style.opacity = "0";
          panel.style.transform = "translateY(30px)";
          panel.style.transition = "opacity 0.6s ease-in-out, transform 0.4s ease-in-out";

          // Position button & panel
          switch (position) {
            case "bottom-left":
              btn.style.bottom = "20px";
              btn.style.left = "20px";
              panel.style.bottom = "80px";
              panel.style.left = "20px";
              break;
            case "top-left":
              btn.style.top = "20px";
              btn.style.left = "20px";
              panel.style.top = "80px";
              panel.style.left = "20px";
              break;
            case "top-right":
              btn.style.top = "20px";
              btn.style.right = "20px";
              panel.style.top = "80px";
              panel.style.right = "20px";
              break;
            default: // bottom-right
              btn.style.bottom = "20px";
              btn.style.right = "20px";
              panel.style.bottom = "80px";
              panel.style.right = "20px";
              break;
          }
          btn.style.transition = "opacity 0.6s ease-in-out";

          let headerDiv = document.createElement("div");
          headerDiv.style.display = "flex";
          headerDiv.style.alignItems = "center";
          headerDiv.style.justifyContent = "space-between";
          headerDiv.style.padding = "10px 15px";
          headerDiv.style.height = "60px";
          headerDiv.style.background = brandColor;
          headerDiv.style.color = "#fff";
          headerDiv.style.borderTopLeftRadius = "12px";
          headerDiv.style.borderTopRightRadius = "12px";

          // Left part: icon + brand name
          let leftHeader = document.createElement("div");
          leftHeader.style.display = "flex";
          leftHeader.style.alignItems = "center";
          let iconImg = document.createElement("img");
          if (brandIcon) {
            iconImg.src = brandIcon;
            iconImg.alt = "brand icon";
            iconImg.style.width = "20px";
            iconImg.style.height = "20px";
            iconImg.style.marginRight = "8px";
          }
          let brandText = document.createElement("span");
          brandText.innerText = `${brandName} AI Assistant`;
          brandText.style.fontSize = "14px";
          brandText.style.fontWeight = "bold";

          leftHeader.appendChild(iconImg);
          leftHeader.appendChild(brandText);

          // Close button inside header
          let closeBtn = document.createElement("button");

          let fadeBrandColor = brandColor + "33"; // '33' is ~20% opacity in hex

          closeBtn.style.backgroundColor = fadeBrandColor; // translucent brand color
          closeBtn.style.borderRadius = "50%"; // circular shape
          closeBtn.innerHTML = ` <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down-icon lucide-chevron-down"><path d="m6 9 6 6 6-6"/></svg>`;

          closeBtn.style.width = "32px";
          closeBtn.style.height = "32px";
          closeBtn.style.display = "flex";
          closeBtn.style.alignItems = "center";
          closeBtn.style.justifyContent = "center";
          closeBtn.style.padding = "0";
          closeBtn.style.color = "#fff";

          closeBtn.style.fontSize = "20px";
          closeBtn.style.border = "none";
          closeBtn.style.cursor = "pointer";
          closeBtn.style.transition = "background-color 0.3s ease";

          headerDiv.appendChild(leftHeader);
          headerDiv.appendChild(closeBtn);

          // Iframe
          let iframe = document.createElement("iframe");
          iframe.src = iframeUrl;
          iframe.position = "relative";
          iframe.style.width = "100%";
          iframe.style.height = "calc(100% - 60px)";
          iframe.style.border = "none";
          iframe.style.borderBottomRightRadius = "12px";
          iframe.style.borderBottomLeftRadius = "12px";
          iframe.style.boxShadow = "0 4px 12px rgba(0,0,0,0.3)";
          iframe.style.display = "block";

          // Assemble panel
          panel.appendChild(headerDiv);
          panel.appendChild(iframe);
          document.body.appendChild(btn);
          document.body.appendChild(panel);

          // Toggle panel
          btn.addEventListener("click", function () {
            // Fade out button
            btn.style.opacity = "0";

            setTimeout(() => {
              btn.style.display = "none";

              // Show panel with animation
              panel.style.display = "block";
              setTimeout(() => {
                panel.style.opacity = "1";
                panel.style.transform = "translateY(0)";
              }, 20); // small delay to ensure transition triggers
            }, 100); // wait for button fade
          });

          closeBtn.addEventListener("click", function () {
            // Hide panel smoothly
            panel.style.opacity = "0";
            panel.style.transform = "translateY(30px)";

            setTimeout(() => {
              panel.style.display = "none";

              // Show button again
              btn.style.display = "block";
              setTimeout(() => {
                btn.style.opacity = "1";
              }, 20);
            }, 150); // match panel transition
          });
          closeBtn.addEventListener("mouseenter", () => {
            closeBtn.style.backgroundColor = brandColor + "33"; // slightly more visible on hover
          });

          closeBtn.addEventListener("mouseleave", () => {
            closeBtn.style.backgroundColor = brandColor;
          });
        } else {
          console.warn("Invalid passkey. Floating button will not be rendered.");
        }
      });
  }
})();
